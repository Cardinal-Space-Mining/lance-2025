{
    "pragma:enable_preproc": true,

    "preset":
    {
        "pragma:default": null,
        "client":
        {
            "pragma:action_overrides":
            {
                "joy_node": "xbox",
                "robot_status": "enabled",
                "foxglove_bridge": "test",
                "foxglove_gui": "local",
                "bag_record": "telemetry"
            }
        },
        "mocha":
        {
            "pragma:action_overrides":
            {
                "teleop_control": "enabled",
                "phoenix6_driver": "enabled",
                "robot_tf": "lance",
                "bag_record": "telemetry"
            }
        },
        "mocha_perception":
        {
            "pragma:derived": "mocha",
            "pragma:action_overrides":
            {
                "perception": "live",
                "multiscan_driver": "robot",
                "bag_record": "sensor_data"
            }
        },
        "frappe":
        {
            "pragma:action_overrides":
            {
                "phoenix5_driver": "enabled",
                "bag_record": "telemetry"
            }
        },
        "robot":
        {
            "pragma:action_overrides":
            {
                "teleop_control": "enabled",
                "phoenix5_driver": "enabled",
                "phoenix6_driver": "enabled",
                "robot_tf": "lance",
                "bag_record": "telemetry"
            }
        },
        "system_test":
        {
            "pragma:derived": "robot",
            "pragma:action_overrides":
            {
                "bag_record": null,
                "joy_node": "xbox",
                "robot_status": "enabled",
                "foxglove_bridge": "test"
            }
        },
        "motor_dev":
        {
            "pragma:action_overrides":
            {
                "joy_node": "xbox",
                "robot_status": "enabled",
                "teleop_control": "enabled",
                "phoenix_motor_sim": "enabled",
                "robot_tf": "lance",
                "foxglove_bridge": "test"
            }
        },
        "lidar_dev":
        {
            "pragma:action_overrides":
            {
                "multiscan_driver": "robot",
                "perception": "lidar-only",
                "pplan_client": "enabled",
                "foxglove_bride": "test",
                "foxglove_gui": "local"
            }
        },
        "lidar_bag":
        {
            "pragma:action_overrides":
            {
                "perception": "test",
                "pplan_client": "enabled",
                "robot_tf": "lance",
                "foxglove_bridge": "test",
                "foxglove_gui": "local"
            }
        }
    },

    "perception":
    {
        "pragma:default": null,
        "live":
        {
            "pragma:action_overrides":
            {
                "pplan_client": "enabled"
            },

            "map_frame_id": "map",
            "odom_frame_id": "odom",
            "base_frame_id": "base_link",
            "scan_topic": "/multiscan/lidar_scan",
            "imu_topic": "/multiscan/imu",
            "tag_usage_mode": 0,
            "metrics_pub_freq": 10.0,
            "exclusion_zones" :
            [
                {
                    "frame_id" : "base_link",
                    "min": [ -0.405, -0.6, 0.0 ],
                    "max": [ 0.735, 0.6, 0.959 ]
                }
            ],
            "trajectory_filter":
            {
                "sampling_window_s": 0.6,
                "min_filter_window_s": 0.4,
                "thresh":
                {
                    "avg_linear_error": 0.01,
                    "avg_angular_error": 0.02,
                    "max_linear_deviation": 0.01,
                    "max_angular_deviation": 0.02
                }
            },
            "dlo":
            {
                "use_timestamps_as_init": false,
                "gravity_align": false,
                "adaptive_params":
                {
                    "use": false,
                    "lpf_coeff": 0.8
                },
                "keyframe":
                {
                    "thresh_D": 1.0,
                    "thresh_R": 30.0,
                    "submap":
                    {
                        "knn": 5,
                        "kcv": 5,
                        "kcc": 5
                    }
                },
                "initial_pose":
                {
                    "use": true,
                    "position": [ 0.0, 0.0, 0.0 ],
                    "orientation": [ 1.0, 0.0, 0.0, 0.0 ]
                },
                "voxel_filter":
                {
                    "scan":
                    {
                        "use": true,
                        "res": 0.15
                    },
                    "submap":
                    {
                        "use": false,
                        "res": 0.15
                    },
                    "adaptive_leaf_size":
                    {
                        "range_coeff": 0.063,
                        "stddev_coeff": 0.064,
                        "offset": -0.29,
                        "floor": 0.04,
                        "ceil": 0.5,
                        "precision": 0.01
                    }
                },
                "immediate_filter":
                {
                    "use": false,
                    "range": 1.0,
                    "thresh_proportion": 0.3
                },
                "imu":
                {
                    "use": true,
                    "use_orientation": true,
                    "calib_time": 3
                },
                "gicp":
                {
                    "num_threads": 4,
                    "min_num_points": 500,
                    "s2s":
                    {
                        "k_correspondences": 10,
                        "max_correspondence_distance": 0.5,
                        "max_iterations": 32,
                        "transformation_epsilon": 0.001,
                        "euclidean_fitness_epsilon": 0.001,
                        "ransac":
                        {
                            "iterations": 5,
                            "outlier_rejection_thresh": 0.1
                        }
                    },
                    "s2m":
                    {
                        "k_correspondences": 15,
                        "max_correspondence_distance": 0.5,
                        "max_iterations": 32,
                        "transformation_epsilon": 0.0005,
                        "euclidean_fitness_epsilon": 0.001,
                        "ransac":
                        {
                            "iterations": 6,
                            "outlier_rejection_thresh": 0.05
                        }
                    }
                }
            },
            "fiducial_detection":
            {
                "max_range": 1.0,
                "plane_seg_thickness": 0.01,
                "ground_seg_thickness": 0.02,
                "up_vec_max_angular_dev": 1.0,
                "planes_max_angular_dev": 0.2,
                "vox_resolution": 0.03,
                "max_proportion_leftover": 0.05,
                "min_num_input_points": 300,
                "min_plane_seg_points": 80
            },
            "mapping":
            {
                "frustum_search_radius": 0.04,
                "radial_distance_thresh": 0.05,
                "delete_delta_coeff": 0.08,
                "delete_max_range": 3.5,
                "add_max_range": 3.5,
                "voxel_size": 0.1
            },
            "traversibility":
            {
                "chunk_horizontal_range": 3.5,
                "chunk_vertical_range": 1.0,
                "normal_estimation_radius": 0.2,
                "interp_grid_res": 0.1,
                "non_trav_grad_angle": 45.0,
                "required_clearance": 1.5,
                "avoidance_radius": 0.5,
                "interp_point_samples": 7
            }
        },
        "sim":
        {
            "pragma:derived": "live",
            "use_sim_time": true
        },
        "test":
        {
            "pragma:derived": "live",
            "pragma:action_overrides":
            {
                "foxglove_bridge": "test"
            }
        },
        "debug":
        {
            "pragma:derived": "test",
            "pragma:node_options":
            {
                "prefix": ["xterm -e gdb -ex run --args"]
            }
        },
        "lidar_only":
        {
            "pragma:derived": "test",
            "base_frame_id": "lidar_link",
            "exclusion_zones": []
        },
        "high_res_map":
        {
            "pragma:derived": "test",
            "mapping":
            {
                "frustum_search_radius": 0.01,
                "radial_distance_thresh": 0.01,
                "delete_delta_coeff": 0.08,
                "delete_max_range": 2.5,
                "add_max_range": 2.5,
                "voxel_size": 0.02
            },
            "traversibility":
            {
                "chunk_horizontal_range": 1.0,
                "chunk_vertical_range": 0.5,
                "normal_estimation_radius": 0.05,
                "interp_grid_res": 0.02,
                "non_trav_grad_angle": 80.0,
                "required_clearance": 1.5,
                "avoidance_radius": 0.1,
                "interp_point_samples": 7
            }
        }
    },

    "tag_detection":
    {
        "pragma:default": null,
        "live":
        {
            "image_transport": "raw",
            "streams":
            [
                {
                    "topics": [
                        "/arena/cam1/image",
                        "/arena/cam1/camera_info",
                        "map"
                    ],
                    "offset": [
                        0.0,
                        0.0,
                        0.8,
                        0.653,
                        -0.653,
                        0.271,
                        -0.271
                    ]
                }
            ],
            "feature": {
                "publish_best_detection_tf": 0,
                "export_best_detection": -1,
                "debug": {
                    "export_all_detections": true,
                    "publish_stream": true,
                    "publish_individual_tag_solution_tfs": false,
                    "publish_group_solution_tfs": true
                }
            },
            "filtering": {
                "bounds_min": [
                    0.2,
                    0.2,
                    -0.3
                ],
                "bounds_max": [
                    6.68,
                    5.0,
                    0.3
                ],
                "use_bounds": true,
                "thresh": {
                    "min_tags_per_range": 0.0,
                    "max_rms_per_tag": 0.4,
                    "min_sum_pix_area": 5000.0,
                    "require_nonplanar_after": 1.5
                }
            },
            "aruco": {
                "predefined_family_idx": 20,
                "tags":
                [
                    {
                        "id": 0,
                        "static": false,
                        "frames": ["base_link"],
                        "corners": [
                            0.23,
                            -0.354,
                            0.401,
                            0.038,
                            -0.354,
                            0.397,
                            0.034,
                            -0.354,
                            0.589,
                            0.226,
                            -0.354,
                            0.593
                        ]
                    },
                    {
                        "id": 1,
                        "static": false,
                        "frames": ["base_link"],
                        "corners": [
                            0.038,
                            0.354,
                            0.397,
                            0.23,
                            0.354,
                            0.401,
                            0.226,
                            0.354,
                            0.593,
                            0.034,
                            0.354,
                            0.589
                        ]
                    },
                    {
                        "id": 2,
                        "static": false,
                        "frames": ["base_link"],
                        "corners": [
                            -0.003,
                            -0.353,
                            0.338,
                            -0.1,
                            -0.281,
                            0.336,
                            -0.102,
                            -0.281,
                            0.456,
                            -0.005,
                            -0.353,
                            0.458
                        ]
                    },
                    {
                        "id": 3,
                        "static": false,
                        "frames": ["base_link"],
                        "corners": [
                            -0.1,
                            0.281,
                            0.336,
                            -0.003,
                            0.353,
                            0.338,
                            -0.005,
                            0.353,
                            0.458,
                            -0.102,
                            0.281,
                            0.456
                        ]
                    },
                    {
                        "id": 4,
                        "static": false,
                        "frames": ["base_link"],
                        "corners": [
                            0.364,
                            -0.28,
                            0.477,
                            0.303,
                            -0.36,
                            0.476,
                            0.301,
                            -0.36,
                            0.576,
                            0.362,
                            -0.28,
                            0.577
                        ]
                    },
                    {
                        "id": 5,
                        "static": false,
                        "frames": ["base_link"],
                        "corners": [
                            0.303,
                            0.36,
                            0.476,
                            0.364,
                            0.28,
                            0.477,
                            0.362,
                            0.28,
                            0.577,
                            0.301,
                            0.36,
                            0.576
                        ]
                    }
                ]
            }
        }
    },

    "pplan_client":
    {
        "pragma:default": null,
        "enabled": {}
    },

    "multiscan_driver":
    {
        "pragma:default": null,
        "robot":
        {
            "pragma:node_options":
            {
                "remappings":
                {
                    "lidar_scan": "/multiscan/lidar_scan",
                    "lidar_imu": "/multiscan/imu"
                }
            },

            "lidar_frame": "lidar_link",
            "lidar_hostname": "10.11.11.3",
            "lidar_udp_port": 2115,
            "sopas_tcp_port": 2111,
            "use_msgpack": false,
            "use_cola_binary": false,
            "udp_reset_timeout": 2.0,
            "udp_receive_timeout": 1.0,
            "sopas_read_timeout": 3.0,
            "error_restart_timeout": 3.0,
            "max_segment_buffers": 3
        }
    },



    "teleop_control":
    {
        "pragma:default": null,
        "enabled": {}
    },
    "phoenix5_driver":
    {
        "pragma:default": null,
        "enabled":
        {
            "diagnostics_port": 1250,
            "canbus": "can_phx5"
        }
    },
    "phoenix6_driver":
    {
        "pragma:default": null,
        "enabled":
        {
            "diagnostics_port": 0,
            "canbus": "can_phx6",
            "arduino_device": "",
            "power_cycle_fault_thresh_s": 1.5,
            "common":
            {
                "kP": 0.4,
                "kI": 0.05,
                "kD": 0.0001,
                "kV": 0.12,
                "neutral_deadband": 0.05,
                "neutral_brake": false,
                "stator_current_limit": 10.0,
                "supply_current_limit": 2.0,
                "voltage_limit": 12.0
            }
        }
    },
    "phoenix_motor_sim":
    {
        "pragma:default": null,
        "enabled": {}
    },
    "robot_status":
    {
        "pragma:default": null,
        "enabled": {}
    },



    "foxglove_bridge":
    {
        "pragma:default": null,
        "test":
        {
            "port": 8765,
            "address": "0.0.0.0",
            "tls": false,
            "certfile": "",
            "keyfile": "",
            "topic_whitelist": [ ".*" ],
            "param_whitelist": [ ".*" ],
            "service_whitelist": [ ".*" ],
            "client_topic_whitelist": [ ".*" ],
            "min_qos_depth": 1,
            "max_qos_depth": 10,
            "num_threads": 4,
            "send_buffer_limit": 5000000000,
            "capabilities": [
                "clientPublish",
                "parameters",
                "parametersSubscribe",
                "services",
                "connectionGraph",
                "assets"
            ],
            "include_hidden": false,
            "asset_uri_allowlist": [
                "^package://(?:\\\\w+/)*\\\\w+\\\\.(?:dae|fbx|glb|gltf|jpeg|jpg|mtl|obj|png|stl|tif|tiff|urdf|webp|xacro)$"
            ]
        },
        "live":
        {
            "pragma:derived": "test",
            "topic_whitelist": [
                "/rosout",
                "/robot_description",
                "/tf.*",
                "/multiscan/.*",
                "/cardinal_perception/metrics/process_stats",
                "/cardinal_perception/metrics/scan_cb_stats",
                "/cardinal_perception/metrics/trav_cb_stats",
                "/cardinal_perception/metrics/mapping_cb_stats",
                "/cardinal_perception/gravity_estimation/*",
                "/cardinal_perception/filtered_scan",
                "/cardinal_perception/traversability_points",
                "/cardinal_perception/trav_interp_points",

                "/joy",

                "/lance/watchdog_status",
                "/lance/control_level",
                "/lance/mining_status",
                "/lance/offload_status",
                "/lance/relay_status",

                "/lance/track_left/ctrl",
                "/lance/track_left/faults",
                "/lance/track_left/info",
                "/lance/track_right/ctrl",
                "/lance/track_right/faults",
                "/lance/track_right/info",
                "/lance/trencher/ctrl",
                "/lance/trencher/faults",
                "/lance/trencher/info",
                "/lance/hopper_belt/ctrl",
                "/lance/hopper_belt/faults",
                "/lance/hopper_belt/info",
                "/lance/hopper_act/ctrl",
                "/lance/hopper_act/faults",
                "/lance/hopper_act/info",

                "/collection_state/is_full_volume",
                "/collection_state/is_full_occ",
                "/collection_state/volume",
                "/collection_state/mining_target",
                "/collection_state/offload_target",
                "/collection_state/belt_pos_m",
                "/collection_state/high_pos_m",
                "/collection_state/low_pos_m",
                "/collection_state/belt_usage_m"
            ],
            "send_buffer_limit": 10000000,
            "capabilities": [
                "clientPublish",
                "services",
                "connectionGraph",
                "assets"
            ]
        }
    },
    "foxglove_gui":
    {
        "pragma:default": null,
        "local":
        {
            "connection": "localhost:8765",
            "use_xdg": true
        },
        "mocha":
        {
            "connection": "mochapanda.local:8765",
            "use_xdg": true
        }
    },
    "joy_node":
    {
        "pragma:default": null,
        "xbox": {}
    },
    "robot_tf":
    {
        "pragma:default": null,
        "lance":
        {
            "robot_description":
            {
                "name": "lance",
                "structure":
                {
                    "links": [
                        "base_link",
                        "frame_link",
                        "left_track_link",
                        "right_track_link",
                        "collection_link",
                        "lidar_link",
                        "lidar_link_inv_rotated"
                    ],
                    "joints":
                    {
                        "frame_joint":
                        {
                            "type": "fixed",
                            "parent": "base_link",
                            "child": "frame_link",
                            "origin":
                            {
                                "xyz": [0, 0, 0.13103567]
                            }
                        },
                        "left_track_joint":
                        {
                            "type": "fixed",
                            "parent": "frame_link",
                            "child": "left_track_link",
                            "origin":
                            {
                                "xyz": [0.20318559, 0.289888, 0.00242022]
                            }
                        },
                        "right_track_joint":
                        {
                            "type": "fixed",
                            "parent": "frame_link",
                            "child": "right_track_link",
                            "origin":
                            {
                                "xyz": [0.20318559, -0.289888, 0.00242022]
                            }
                        },
                        "dump_joint":
                        {
                            "type": "revolute",
                            "parent": "frame_link",
                            "child": "collection_link",
                            "origin":
                            {
                                "xyz": [-0.45721441, 0, 0.18580822],
                                "rpy": [0, -0.2617994, 0]
                            },
                            "axis": [0, 1, 0],
                            "limit":
                            {
                                "upper": 0.2617994,
                                "lower": -0.2617994,
                                "effort": 100,
                                "velocity": 100
                            }
                        },
                        "lidar_joint":
                        {
                            "type": "fixed",
                            "parent": "frame_link",
                            "child": "lidar_link",
                            "origin":
                            {
                                "xyz": [0.64957717, 0, 0.42478867],
                                "rpy": [2.836255, -0.171851, -2.067879]
                            }
                        },
                        "lidar_joint_inv_rotated":
                        {
                            "type": "fixed",
                            "parent": "lidar_link",
                            "child": "lidar_link_inv_rotated",
                            "origin":
                            {
                                "xyz": [0, 0, 0],
                                "rpy": [0, 0, 2.09439510239]
                            }
                        }
                    }
                },
                "assets":
                {
                    "frame_link": {
                        "collision": [
                            {
                                "origin": {
                                    "xyz": [ 0.1511222, 0.304108825, 0.36666339 ]
                                },
                                "geometry": {
                                    "type": "box",
                                    "size": [ 0.30495059, 0.07924165, 0.20322540 ]
                                }
                            },
                            {
                                "origin": {
                                    "xyz": [ 0.1511222, -0.304108825, 0.36666339 ]
                                },
                                "geometry": {
                                    "type": "box",
                                    "size": [ 0.30495059, 0.07924165, 0.20322540 ]
                                }
                            }
                        ]
                    },
                    "left_track_link": {
                        "collision": {
                            "origin": {
                                "xyz": [ -0.220493525, 0.023822025, -0.048669135 ]
                            },
                            "geometry": {
                                "type": "box",
                                "size": [ 0.74116316, 0.10161905, 0.17943783 ]
                            }
                        }
                    },
                    "right_track_link": {
                        "collision": {
                            "origin": {
                                "xyz": [ -0.220493525, -0.023822025, -0.048669135 ]
                            },
                            "geometry": {
                                "type": "box",
                                "size": [ 0.74116316, 0.10161905, 0.17943783 ]
                            }
                        }
                    },
                    "collection_link": {
                        "collision": [
                            {
                                "origin": {
                                    "xyz": [ 0.340890235, 0.0, 0.119396825 ]
                                },
                                "geometry": {
                                    "type": "box",
                                    "size": [ 0.71292228, 0.46990000, 0.38611050 ]
                                }
                            },
                            {
                                "origin": {
                                    "xyz": [ 0.76657724, 0.0, -0.010579805 ],
                                    "rpy": [ 0.0, -0.372067876223, 0.0 ]
                                },
                                "geometry": {
                                    "type": "box",
                                    "size": [ 0.17228316, 0.26035000, 0.73220119 ]
                                }
                            }
                        ]
                    },
                    "lidar_link":
                    {
                        "collision": [
                            {
                                "origin": { "xyz": [0, 0, -0.006] },
                                "geometry": {
                                    "type": "cylinder",
                                    "radius": 0.05,
                                    "length": 0.098
                                }
                            },
                            {
                                "origin": {
                                     "xyz": [0, 0, -0.075],
                                     "rpy": [0, 0, -2.09439510239]
                                },
                                "geometry": {
                                    "type": "box",
                                    "size": [ 0.10160000, 0.52897600, 0.05397500 ]
                                }
                            }
                        ]
                    }
                }
            }
        }
    },
    "bag_play":
    {
        "pragma:default": "lidar",
        "lidar":
        {
            "topics": [
                "/multiscan/lidar_scan",
                "/multiscan/imu"
            ],
            "start_paused": true,
            "loop": false,
            "remappings": {}
        },
        "lidar_with_tf":
        {
            "topics": [
                "/multiscan/lidar_scan",
                "/multiscan/imu",
                "/tf",
                "/tf_static"
            ]
        },
        "cosmic_bag":
        {
            "topics": [
                "/multiscan/lidar_scan",
                "/multiscan/imu",
                "/lance/watchdog_status",
                "/lance/control_level",
                "/lance/mining_status",
                "/lance/offload_status",
                "/lance/hopper_act/info",
                "/lance/hopper_belt/info",
                "/lance/track_left/info",
                "/lance/track_right/info",
                "/lance/trencher/info"
            ],
            "start_paused": true,
            "start_time": 359.0,
            "loop": false
        }
    },
    "bag_record":
    {
        "pragma:default": null,
        "all":
        {
            "output_prefix": "bag_recordings/lance_raw_data"
        },
        "sensor_data":
        {
            "output_prefix": "bag_recordings/lance_sensor_data",
            "topics": [
                "/multiscan/lidar_scan",
                "/multiscan/imu",
                "/tf",
                "/tf_static"
            ]
        },
        "telemetry":
        {
            "output_prefix": "bag_recordings/lance_telemetry",
            "topics": [
                "/joy",
                "/lance/watchdog_status",
                "/lance/control_level",
                "/lance/mining_status",
                "/lance/offload_status",
                "/lance/relay_status",

                "/lance/track_left/ctrl",
                "/lance/track_left/faults",
                "/lance/track_left/info",

                "/lance/track_right/ctrl",
                "/lance/track_right/faults",
                "/lance/track_right/info",

                "/lance/trencher/ctrl",
                "/lance/trencher/faults",
                "/lance/trencher/info",

                "/lance/hopper_belt/ctrl",
                "/lance/hopper_belt/faults",
                "/lance/hopper_belt/info",

                "/lance/hopper_act/ctrl",
                "/lance/hopper_act/faults",
                "/lance/hopper_act/info",

                "/collection_state/is_full_volume",
                "/collection_state/is_full_occ",
                "/collection_state/volume",
                "/collection_state/mining_target",
                "/collection_state/offload_target",
                "/collection_state/belt_pos_m",
                "/collection_state/high_pos_m",
                "/collection_state/low_pos_m",
                "/collection_state/belt_usage_m",

                "/rosout"
            ]
        }
    }
}
